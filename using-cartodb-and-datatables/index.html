<!doctype html>
<html class="no-js" lang="en">
<head>
		<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Using CartoDB for creating data driven web pages</title>
	<link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/styles_feeling_responsive.css" />
	<script src="http://localhost:4000/assets/js/modernizr.min.js"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
  <script>
    WebFont.load({
      google: {
        families: [ 'Lato:400,700,400italic:latin', 'Work+Sans:400,700:latin' ]
      }
    });
  </script>

  <noscript>
    <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic|Volkhov' rel='stylesheet' type='text/css' />
  </noscript>

  <meta name="google-site-verification" content="hb0oFgJAnd2i2LvJYSEIofF5sc24xc8hx2tTNittvHA" />
	
	<meta name="description" content="Using CartoDB.js, SQL API with the jQuery Data Tables API to create an interactive resource guide." />

	<link rel="author" href="https://plus.google.com/u/0/103791827597799558729"/>

	



	
	<link rel="icon" sizes="32x32" href="http://localhost:4000/assets/img/favicon-32x32.png" />




	
	<link rel="icon" sizes="192x192" href="http://localhost:4000/assets/img/touch-icon-192x192.png" />




	
	<link rel="apple-touch-icon-precomposed" sizes="180x180" href="http://localhost:4000/assets/img/apple-touch-icon-180x180-precomposed.png" />




	
	<link rel="apple-touch-icon-precomposed" sizes="152x152" href="http://localhost:4000/assets/img/apple-touch-icon-152x152-precomposed.png" />




	
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/assets/img/apple-touch-icon-144x144-precomposed.png" />




	
	<link rel="apple-touch-icon-precomposed" sizes="120x120" href="http://localhost:4000/assets/img/apple-touch-icon-120x120-precomposed.png" />




	
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/assets/img/apple-touch-icon-114x114-precomposed.png" />




	
	<link rel="apple-touch-icon-precomposed" sizes="76x76" href="http://localhost:4000/assets/img/apple-touch-icon-76x76-precomposed.png" />




	
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/assets/img/apple-touch-icon-72x72-precomposed.png" />




	
	<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/assets/img/apple-touch-icon-precomposed.png" />	




	
	<meta name="msapplication-TileImage" content="http://localhost:4000/assets/img/msapplication_tileimage.png" />




	
	<meta name="msapplication-TileColor" content="#fabb00" />



	<!-- Facebook Optimization -->
	<meta property="og:locale" content="en_EN" />
	
	<meta property="og:title" content="Using CartoDB for creating data driven web pages" />
	<meta property="og:description" content="The portfolio and technical blog of Chris Henrick – provider of professional web development, data visualization, GIS, mapping, &amp; cartography services." />
	<meta property="og:url" content="http://localhost:4000//using-cartodb-and-datatables/" />
	<meta property="og:site_name" content="Chris Henrick – Web Development, Data Visualization, GIS, Maps, and Cartography" />
	

	

	<!-- Search Engine Optimization -->
	<meta name="description" content="">
	<meta name="google-site-verification" content="hb0oFgJAnd2i2LvJYSEIofF5sc24xc8hx2tTNittvHA">
	
	
	<link rel="author" href="https://plus.google.com/u/0/103791827597799558729">
	
	
	<link rel="canonical" href="http://localhost:4000/using-cartodb-and-datatables/">

	
	<!-- Twitter -->
	<meta name="twitter:card" content="summary">
	<meta name="twitter:site" content="@chrislhenrick">
	<meta name="twitter:creator" content="@chrislhenrick">
	<meta name="twitter:title" content="Chris Henrick – Web Development, Data Visualization, GIS, Maps, and Cartography">
	<meta name="twitter:description" content="The portfolio and technical blog of Chris Henrick – provider of professional web development, data visualization, GIS, mapping, & cartography services.">
	<meta name="twitter:image" content="http://localhost:4000/images/clhenrick-landing-header.jpg">
	

	<link type="text/plain" rel="author" href="http://localhost:4000/humans.txt" />

	

	
</head>

</head>
<body id="top-of-page" class="">
	
	
<div id="navigation" class="sticky">
  <nav class="top-bar" role="navigation" data-topbar>
    <ul class="title-area">
      <li class="name">
      <h1 class="show-for-small-only"><a href="http://localhost:4000" class="icon-tree"> Chris Henrick</a></h1>
    </li>
       <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
      <li class="toggle-topbar menu-icon"><a href="#"><span></span></a></li>
    </ul>
    <section class="top-bar-section">

      <ul class="right">
        

              

          
          
        

              

          
          
        

              

          
          
        

              

          
          
        

              

          
          
            
            
              <li class="divider"></li>
              <li><a href="http://localhost:4000/search/">Search</a></li>

            
            
          
        

              

          
          
            
            
              <li class="divider"></li>
              <li><a href="http://localhost:4000/contact/">Contact</a></li>

            
            
          
        
        
      </ul>

      <ul class="left">
        

              

          
          

            
            
              <li><a href="http://localhost:4000/">clhenrick</a></li>
              <li class="divider"></li>

            
            
          
        

              

          
          

            
            
              <li><a href="http://localhost:4000/work/">Work</a></li>
              <li class="divider"></li>

            
            
          
        

              

          
          

            
            

              <li class="has-dropdown">
                <a href="http://localhost:4000/about/">About</a>

                  <ul class="dropdown">
                    

                      

                      <li><a href="http://localhost:4000/about/cv/">CV</a></li>
                    

                      

                      <li><a href="http://localhost:4000/about/talks/">Talks</a></li>
                    
                  </ul>

              </li>
              <li class="divider"></li>
            
          
        

              

          
          

            
            

              <li class="has-dropdown">
                <a href="http://localhost:4000/blog/">Blog</a>

                  <ul class="dropdown">
                    

                      

                      <li><a href="http://localhost:4000/blog/archive/">Blog Archive</a></li>
                    
                  </ul>

              </li>
              <li class="divider"></li>
            
          
        

              

          
          
        

              

          
          
        
        
      </ul>
    </section>
  </nav>
</div><!-- /#navigation -->

	

	





	<div class="row t30">
	<div class="medium-8 columns medium-offset-2 end">
		<article itemscope itemtype="http://schema.org/Article">
			<header>
				

				<span itemprop="name">
					
					<h1>Using CartoDB for creating data driven web pages</h1>
				</span>
			</header>


			
			<p class="teaser" itemprop="description">
				Using CartoDB.js, SQL API with the jQuery Data Tables API to create an interactive resource guide.
			</p>
			

			<span itemprop="articleSection">
			<h2 id="topics-covered">Topics Covered</h2>
<ul>
  <li><a href="#what-is-cartodb">Using CartoDB as a datastore</a></li>
  <li><a href="#scripting-your-data-wrangling-workflow">Scripting your data wrangling workflow </a></li>
  <li><a href="#using-the-cartodb-sql-api">Using the SQL API to load your data to your website / app</a></li>
  <li><a href="#using-the-cartodb-js-library">Using the CartoDB JS library to render data on top of an interactive web map</a></li>
</ul>

<h2 id="background">Background</h2>
<p>Recently at Radish Lab I created an interactive resource guide for the <a href="http://wccny.org/">Women’s City Club of New York</a>. The goal of the guide is</p>

<blockquote>
  <p>to help individuals and organizations access needed low- or no-cost social services, programs, and resources available throughout the five boroughs of New York City. Most entries include address, phone number and website, as well as the neighborhood and community board in which the agency is located.</p>
</blockquote>

<p>WCCNY asked to have the guide exist in a searchable and filterable format, so <a href="https://www.datatables.net/">jQuery DataTables</a> seemed like a practical solution. Additionally because the data is geographic in nature (the majority of the data has detailed street address location information) this meant it could be mapped. As a result I decided to use <a href="http://cartodb.com">CartoDB</a> to host and map the data.</p>

<p>You can visit the guide by clicking on the image below:
<br /><br />
<a href="http://resourceguide.wccny.org/"><img src="/images/wcc-resource-guide.png" alt="screen shot of the WCCNY Resource Guide" /></a></p>

<h2 id="what-is-cartodb">What is CartoDB?</h2>
<p>Put simply <a href="http://cartodb.com">CartoDB</a> is web platform that focuses on making it easy to map and analyze geospatial data. It is built on top of a suite of open source software for database management, GIS, and web-mapping. With CartoDB you can drag and drop data into its dashboard and instantly start prototyping an interactive map data-vizualization or querying your data with <a href="https://en.wikipedia.org/wiki/SQL">SQL</a>. They’ve built quite a large following in the GIS, web-development, and Cartography world, provide plenty of educational materials and tutorials to get you started, and have great customer service and support.</p>

<h2 id="scripting-your-data-wrangling-workflow">Scripting Your Data Wrangling Workflow</h2>

<p>One of the great things about using CartoDB is that it provides the full functionality of using <a href="http://www.postgresql.org/">PostgreSQL</a> (also commonly referred to as Postgres), a very popular open-source relational database, and <a href="http://postgis.net/">PostGIS</a>, an extension for Postgres that allows for working with geospatial data –that is data that has a geometry data type. However, just because CartoDB has the ability to host geospatial data doesn’t mean <em>you have to use it for that.</em> You can use it like any plain old database and then use their tools to integrate your data with your webpage <em>without having to set up a server running a database yourself!</em></p>

<p>One of the common issues of working with data is having to run similar tasks repeatidly on your data, such as updating, formating, etc. This comes up quite frequently at Radish when we work with clients to create web-interactives that are data driven. Rather than using software such as Excel and having to do a lot of repeated clicking and macros running, we can write SQL code that can be executed each time we need to repeat a task. Then we can simply copy and paste the SQL code from a text editor into the SQL window in CartoDB’s dashboard, and run it. You can even do this with a whole series of commands.</p>

<p>A simple task might be to remove any trailing white space from a field that contains text:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="c1">-- remove trailing whitespace</span>
<span class="k">UPDATE</span> <span class="k">table_name</span> 
<span class="k">SET</span> <span class="n">field_name</span> <span class="o">=</span> <span class="n">regexp_replace</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="s1">'</span><span class="se">\s</span><span class="s1">+$'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">);</span></code></pre></figure>

<p>Or perhaps you may want to create additional columns based on existing data in a table that will be used by your web app but not displayed to the user. One such example is to simplify data from a field, such as for boroughs:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="c1">-- add a column to store the borough code:</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="k">table_name</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">borough</span> <span class="n">TEXT</span><span class="p">;</span>

<span class="c1">-- add values to the borough column</span>
<span class="k">UPDATE</span> <span class="k">table_name</span> <span class="k">SET</span> <span class="n">borough</span> <span class="o">=</span> <span class="s1">'BK'</span> <span class="k">WHERE</span> <span class="n">addressline2</span> <span class="k">ILIKE</span> <span class="s1">'%brooklyn%'</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="k">table_name</span> <span class="k">SET</span> <span class="n">borough</span> <span class="o">=</span> <span class="s1">'MN'</span> <span class="k">WHERE</span> <span class="n">addressline2</span> <span class="k">ILIKE</span> <span class="s1">'%new york%'</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="k">table_name</span> <span class="k">SET</span> <span class="n">borough</span> <span class="o">=</span> <span class="s1">'BX'</span> <span class="k">WHERE</span> <span class="n">addressline2</span> <span class="k">ILIKE</span> <span class="s1">'bronx%'</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="k">table_name</span> <span class="k">SET</span> <span class="n">borough</span> <span class="o">=</span> <span class="s1">'QN'</span> <span class="k">WHERE</span> <span class="n">addressline2</span> <span class="k">ILIKE</span> <span class="s1">'queens%'</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="k">table_name</span> <span class="k">SET</span> <span class="n">borough</span> <span class="o">=</span> <span class="s1">'SI'</span> <span class="k">WHERE</span> <span class="n">addressline2</span> <span class="k">ILIKE</span> <span class="s1">'staten island%'</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="k">table_name</span> <span class="k">SET</span> <span class="n">borough</span> <span class="o">=</span> <span class="s1">'N/A'</span> <span class="k">WHERE</span> <span class="n">addressline2</span> <span class="k">IS</span> <span class="k">NULL</span> <span class="k">OR</span> <span class="n">addressline2</span> <span class="k">ILIKE</span> <span class="s1">'%n/a%'</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="k">table_name</span> <span class="k">SET</span> <span class="n">borough</span> <span class="o">=</span> <span class="s1">'N/A'</span> <span class="k">WHERE</span> <span class="n">borough</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">;</span></code></pre></figure>

<p>Then any time you need to update the data in CartoDB you can just copy and paste your SQL code into the dashboard SQL window and re-run your workflow. As soon as you update your data in CartoDB, the changes will be reflected on any webpage you have that is using that data.</p>

<h2 id="using-the-cartodb-sql-api">Using the CartoDB SQL API</h2>
<p>On top of a intuitive and easy to use dashboard, CartoDB provides a RESTful SQL API endpoint which allows you to pass SQL queries to your data tables and get back the data in JSON format. As long as your table is “public” in your account you do not need an API Key to perform <code class="highlighter-rouge">SELECT</code> queries. You may also perform <code class="highlighter-rouge">UPDATE</code>, <code class="highlighter-rouge">DELETE</code>, and <code class="highlighter-rouge">INSERT</code> queries with an API Key generated from your CartoDB account if you’d like. Just be sure to not include your API Key anywhere that is publically visible on your website!</p>

<p>At the time of this writing the CartoDB SQL API endpoint is in the following format:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">https://{account}.cartodb.com/api/v2/sql?q={SQL statement}&amp;api_key={Your API key}</code></pre></figure>

<p>You would simply replace <code class="highlighter-rouge"><span class="p">{</span><span class="err">account</span><span class="p">}</span></code> with your CartoDB account name and <code class="highlighter-rouge"><span class="p">{</span><span class="err">SQL</span><span class="w"> </span><span class="err">statement</span><span class="p">}</span></code> with your SQL query, eg:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">https://my_account_name.cartodb.com/api/v2/sql?q=SELECT * FROM my_table</code></pre></figure>

<p>The Response will be in JSON format and have the following structure:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nt">"rows"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="err">...</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="err">...</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="err">...</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="err">...</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="err">...</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="err">...</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="err">...</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="err">...</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="err">...</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="err">...</span><span class="p">},</span><span class="w">
        </span><span class="err">...</span><span class="w">
        </span><span class="p">],</span><span class="w">
    </span><span class="nt">"time"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span><span class="w">
    </span><span class="nt">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span><span class="w">
    </span><span class="nt">"total_rows"</span><span class="p">:</span><span class="w"> </span><span class="mi">1649</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>Each row has data stored in an object with the column name as the key and that column’s respective row as the value:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nt">"nameoforganization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Community Parents, Inc."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"neighborhood"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bedford-Stuyvesant"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"addressline1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"90 Chauncey Street"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"addressline2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Brooklyn, NY"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"zipcode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"11233"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"communityboardnumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"phonenumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"718-771-4002"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"alternativecontact"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nt">"website"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://www.headstartsbc.org"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"category1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pre-School &amp; Childcare"</span><span class="p">,</span><span class="w">
    </span><span class="err">...</span><span class="w">
</span><span class="err">}</span></code></pre></figure>

<p>For the resource guide we are building for the Women’s City Club I pass JSON data from the CartoDB SQL API to the <a href="https://www.datatables.net/">jQuery Data Table API</a> to render a searchable and interactive HTML table:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="c1">// create the dataTable from the CartoDB SQL API response</span>
  <span class="kd">var</span> <span class="nx">dtable</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#data-table'</span><span class="p">).</span><span class="nx">DataTable</span><span class="p">({</span>
    <span class="na">ajax</span> <span class="p">:</span> <span class="p">{</span>
      <span class="na">url</span> <span class="p">:</span> <span class="nx">queryURIencoded</span><span class="p">,</span>
      <span class="na">type</span> <span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
      <span class="na">dataSrc</span> <span class="p">:</span> <span class="s1">'rows'</span>
    <span class="p">},</span>
    <span class="na">order</span> <span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">"asc"</span><span class="p">]],</span>
    <span class="na">columns</span> <span class="p">:</span> <span class="nx">dtableColumns</span>
  <span class="p">});</span></code></pre></figure>

<p>Where <code class="highlighter-rouge">queryURIencoded</code> is a variable containing the CartoDB SQL API endpoint with the SQL query I’ve provided, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI">URI encoded</a>.</p>

<h2 id="using-the-cartodb-js-library">Using the CartoDB JS Library</h2>
<p>And why would they call it <strong>Carto</strong>DB if you couldn’t make a map with it? CartoDB makes that easy with their javascript library so you can integrate your data hosted on CartoDB with popular web-mapping API’s such as <a href="https://www.datatables.net/">Leaflet JS</a>, <a href="http://openlayers.org/">Open Layers</a>, and yes even Google Maps. You can read more about the library in their <a href="http://docs.cartodb.com/cartodb-platform/cartodb-js.html">documentation</a> and learn how to use it from their <a href="http://docs.cartodb.com/tutorials/create_map_cartodbjs.html">tutorials</a>.</p>

<p>For the Resource Guide we are building this is how the data being displayed on the map changes, as well as the map’s zoom level and extent, after the user applies filters through the UI:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">updateMap</span><span class="p">(</span><span class="nx">ids</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">cdb_ids</span><span class="p">,</span> <span class="nx">sql</span><span class="p">,</span> <span class="nx">bbox_sql</span><span class="p">,</span> <span class="nx">sql_encoded</span><span class="p">,</span> <span class="nx">url</span><span class="p">;</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">ids</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">cdb_ids</span> <span class="o">=</span> <span class="nx">ids</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">','</span><span class="p">);</span>
    <span class="c1">// add a "where clause" to our select query</span>
    <span class="nx">sql</span> <span class="o">=</span> <span class="nx">cdbQuery</span> <span class="o">+</span> <span class="s2">" WHERE cartodb_id IN ("</span> <span class="o">+</span> <span class="nx">cdb_ids</span> <span class="o">+</span> <span class="s2">")"</span><span class="p">;</span> 
    <span class="c1">// write a PostGIS SQL query to get the bounding box of our features</span>
    <span class="nx">bbox_sql</span> <span class="o">=</span> <span class="s2">"SELECT St_AsGeoJSON(ST_SetSRID(ST_Extent(the_geom),4326)) as table_extent FROM "</span> <span class="o">+</span> <span class="nx">tableName</span> <span class="o">+</span> <span class="s2">" WHERE cartodb_id IN ("</span> <span class="o">+</span> <span class="nx">cdb_ids</span> <span class="o">+</span> <span class="s2">")"</span><span class="p">;</span>
    <span class="nx">sql_encoded</span> <span class="o">=</span> <span class="nb">encodeURI</span><span class="p">(</span><span class="nx">bbox_sql</span><span class="p">);</span>
    <span class="nx">url</span> <span class="o">=</span> <span class="nx">cdbEndpoint</span> <span class="o">+</span> <span class="nx">sql_encoded</span><span class="p">;</span>
    <span class="nx">getBounds</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
  
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">sql</span> <span class="o">=</span> <span class="nx">cdbQuery</span> <span class="o">+</span> <span class="s2">" WHERE cartodb_id = 0"</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c1">// update the features being displayed on the map</span>
  <span class="nx">features</span><span class="p">.</span><span class="nx">setSQL</span><span class="p">(</span><span class="nx">sql</span><span class="p">);</span>
    
 <span class="p">}</span> 

<span class="kd">function</span> <span class="nx">getBounds</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// pan and zoom the map to fit the geographic bounds of the updated features </span>
  <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">table_extent</span><span class="p">),</span>
        <span class="nx">coords</span> <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="nx">bounds</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">latlng</span><span class="p">;</span>
  
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">coords</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>        
      <span class="c1">// reverse the order of the coordinates as Leaflet likes lat lon, not lon lat!</span>
      <span class="nx">latlng</span> <span class="o">=</span> <span class="nx">coords</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">reverse</span><span class="p">();</span> 
      <span class="nx">bounds</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">latLng</span><span class="p">(</span><span class="nx">latlng</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">latlng</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
    <span class="p">}</span>
  
    <span class="nx">map</span><span class="p">.</span><span class="nx">fitBounds</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">latLngBounds</span><span class="p">(</span><span class="nx">bounds</span><span class="p">));</span>
  <span class="p">});</span>
<span class="p">}</span></code></pre></figure>

<p>When the user applies filters to the dataset, the Data Tables API sends an array of ids from the filtered rows to the the <code class="highlighter-rouge">updateMap</code> function. The ids are then joined using using a comma as a delimiter and inserted into an SQL <code class="highlighter-rouge">WHERE</code> clause. A second query is created that will grab the filtered feature’s geographic extent using the PostGIS functions <a href="http://postgis.org/docs/ST_AsGeoJSON.html">ST_AsGeoJSON</a>, <a href="http://postgis.refractions.net/docs/ST_SetSRID.html">ST_SetSRID</a>, and <a href="http://postgis.net/docs/ST_Extent.html">ST_Extent</a>. The first query eventually is passed to the CartoDB javascript library to update the features being displayed on the map. The second query is passed to the function <code class="highlighter-rouge">getBounds</code> which performs an AJAX request to the CartoDB SQL API endpoint. The features returned from this query are then passed to Leaflet’s <a href="http://leafletjs.com/reference.html#map-fitbounds">map.fitBounds</a> method which centers the map and changes the zoom level to fit the map to a specified geographic area.</p>

<p>As you can see, using CartoDB as a database to interact with for your web interactive offers a whole lot of helpful functionality. You don’t have to use it specifically for mapping purposes, but it sure doesn’t hurt if you are working with geospatial data.</p>


			</span>

			
						<div id="page-meta" class="t30">
				<p>
					<!-- Look the author details up from the site config. -->
					
					<!-- Output author details if some exist. -->
					
					<span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name" class="pr20 icon-edit"><a href="http://clhenrick.io/" target="_blank"> Chris Henrick</a></span>
				</span>
				

				
				<time class="icon-calendar pr20" datetime="2015-10-07" itemprop="datePublished"> 2015-10-07</time>
				

				<span class="icon-archive pr20"> </span>
				<br />
				<span class="pr20"><span class="icon-price-tag pr10"> data</span> <span class="icon-price-tag pr10"> cartodb</span> <span class="icon-price-tag pr10"> data-tables</span> </span>
			</p>

			<div id="post-nav" class="row">
				
				<div class="small-4 columns text-center"><a class="button small radius prev" href="http://localhost:4000/data-processing-wwc001/">&laquo; Data Processing Methodology for "Tracking the Energy Titans"</a></div><!-- /.small-4.columns -->
				
				<div class="small-4 columns text-center"><a class="radius button small" href="http://localhost:4000/blog/archive/" title="Blog Archive">Archive</a></div><!-- /.small-4.columns -->
				
				<div class="small-4 columns text-center"><a class="button small radius next" href="http://localhost:4000/using-the-js-modular-pattern/">Using the Module Pattern in Javascript Programming &raquo;</a></div><!-- /.small-4.columns -->
				
			</div>
			</div><!--  /.page-meta -->
			

			
						
				<h3 id="comments" class="t60">Dialogue &amp; Discussion</h3>
				<div id="disqus_thread"></div>
				<script>
				    var disqus_config = function () {
				        this.page.url =  'http://localhost:4000'
				        this.page.identifier = '/using-cartodb-and-datatables/';
								this.page.title = 'Using CartoDB for creating data driven web pages';
				    };
				    (function() {  // DON'T EDIT BELOW THIS LINE
				        var d = document, s = d.createElement('script');

				        s.src = '//clhenrick.disqus.com/embed.js';

				        s.setAttribute('data-timestamp', +new Date());
				        (d.head || d.body).appendChild(s);
				    })();
				</script>
				<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			

			
		</article>
	</div><!-- /.medium-8.columns -->


	


	
</div><!-- /.row -->


	
	    <div id="up-to-top" class="row">
      <div class="small-12 columns" style="text-align: right;">
        <a class="iconfont" href="#top-of-page">&#xf108;</a>
      </div><!-- /.small-12.columns -->
    </div><!-- /.row -->


    <footer id="footer-content" class="bg-grau">
      <div id="footer">
        <div class="row">
          <div class="medium-6 large-5 columns">
            <h5 class="shadow-black">About This Site</h5>

            <p class="">
              The portfolio and technical blog of Chris Henrick – provider of professional web development, data visualization, GIS, mapping, & cartography services.
              <a href="http://localhost:4000/about/">More ›</a>
            </p>
          </div><!-- /.large-6.columns -->


          <div class="small-6 medium-3 large-3 large-offset-1 columns">
            
              
                <h5 class="shadow-black">Services</h5>
              
            
              
            
              
            
              
            
              
            

              <ul class="no-bullet shadow-black">
              
                
                  <li >
                    <a href=""  title=""></a>
                  </li>
              
                
                  <li >
                    <a href="/contact/"  title="Contact">Contact</a>
                  </li>
              
                
                  <li >
                    <a href="/feed.xml"  title="Subscribe to RSS Feed">RSS</a>
                  </li>
              
                
                  <li >
                    <a href="/atom.xml"  title="Subscribe to Atom Feed">Atom</a>
                  </li>
              
                
                  <li >
                    <a href="/sitemap.xml"  title="Sitemap for Google Webmaster Tools">sitemap.xml</a>
                  </li>
              
              </ul>
          </div><!-- /.large-4.columns -->


          <div class="small-6 medium-3 large-3 columns">
            
              
                <h5 class="shadow-black">Network</h5>
              
            
              
            
              
            

            <ul class="no-bullet shadow-black">
            
              
                <li >
                  <a href=""  title=""></a>
                </li>
            
              
                <li class="services-newsletter" >
                  <a href="http://foundation.zurb.com/" target="_blank"  title="Built on Foundation">Built on Foundation</a>
                </li>
            
              
                <li class="site-code" >
                  <a href="https://github.com/clhenrick/portfolio" target="_blank"  title="Code available on Github">Code on Github</a>
                </li>
            
            </ul>
          </div><!-- /.large-3.columns -->
        </div><!-- /.row -->

      </div><!-- /#footer -->


      <div id="subfooter">
        <nav class="row">
          <section id="subfooter-left" class="small-12 medium-6 columns credits">
            <p>
              Created with &hearts;
              by&nbsp;<a href="http://clhenrick.io/">Chris&nbsp;Henrick</a>
              using&nbsp;<a href="http://jekyllrb.com/" target="_blank">Jekyll</a>
              based&nbsp;on&nbsp;<a href="http://phlow.github.io/feeling-responsive/">Feeling&nbsp;Responsive</a>.
            </p>
          </section>

          <section id="subfooter-right" class="small-12 medium-6 columns">
            <ul class="inline-list social-icons">
            
              <li><a href="https://github.com/clhenrick" target="_blank" class="icon-github" title="Code"></a></li>
            
              <li><a href="https://twitter.com/chrislhenrick" target="_blank" class="icon-twitter" title="Twitter"></a></li>
            
            </ul>
          </section>
        </nav>
      </div><!-- /#subfooter -->
    </footer>

	

	

<!-- jQuery -->
<script src="http://localhost:4000/assets/js/javascript.min.js"></script>
<!-- lazy load -->
<script src="http://localhost:4000/assets/js/jquery.lazyload.min.js"></script>

<script type="text/javascript">
// make all external links open in a new browser tab
// code credit: https://css-tricks.com/snippets/jquery/open-external-links-in-new-window/
$(function(){
  $('a').each(function() {
     var a = new RegExp('/' + window.location.host + '/');
     if(!a.test(this.href)) {
         $(this).click(function(event) {
             event.preventDefault();
             event.stopPropagation();
             window.open(this.href, '_blank');
         });
     }
  });

  // lazy load images with class "lazy"
  $("img.lazy").lazyload({
    threshold: 200,
    effect: "fadeIn"
  });
});

</script>








<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-69968207-1', 'auto');
  ga('set', 'anonymizeIp', true);
  ga('send', 'pageview');

</script>







</body>
</html>

